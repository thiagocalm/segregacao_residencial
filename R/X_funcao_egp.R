
# funcao --------------------------------------------------------------------

func_tratamento_classes_egp <- function(
    dados = censo,
    dados_cnae = tabela_cnae,
    dados_cbo = tabela_cbo,
    dados_ajuste_cnae = tabela_cnae_ajuste,
    dados_ajuste_cbo = tabela_cbo_ajuste,
    var_cnae_censo = "v4462",
    var_cnae_compatibilizacao = "CNAE_Dom",
    compatibilizacao_cnae = TRUE,
    var_cbo_compatibilizacao = "CBO_Domiciliar",
    compatibilizacao_cbo = TRUE,
    construir_var_pea = TRUE,
    var_trabalhando = "v0439",
    var_afastado = "v0440",
    var_aprendiz = "v0441",
    var_trabalho_cultivo = "v0442",
    var_trabalho_consumo = "v0443",
    var_buscou_emprego = "v0455",
    var_posicao_ocupacao = "v0447",
    var_codigo_ocupacao = "v4452"){

  # variaveis que serao utilizadas
  vars <- c(var_trabalhando,var_afastado,var_aprendiz,var_trabalho_consumo,var_buscou_emprego,
            var_posicao_ocupacao, var_codigo_ocupacao)

  ## criacao da base menor de trabalho

  print(paste0("Começando processo de compatibilização..."))

  # Compatibilizacao da CNAE
  if(compatibilizacao_cnae == TRUE){
    if(var_cnae_compatibilizacao == "CNAE_Dom"){

      # Ajuste de nomes de variaveis e de algumas variaveis importantes no processamento
      censo_processing <- dados |>
        select(id_dom, id_pes,
               var_cnae_censo = all_of(var_cnae_censo),
               var_trabalhando = all_of(var_trabalhando),
               var_afastado = all_of(var_afastado),
               var_aprendiz = all_of(var_aprendiz),
               var_trabalho_cultivo = all_of(var_trabalho_cultivo),
               var_trabalho_consumo = all_of(var_trabalho_consumo),
               var_buscou_emprego = all_of(var_buscou_emprego),
               var_posicao_ocupacao = all_of(var_posicao_ocupacao),
               var_codigo_ocupacao = all_of(var_codigo_ocupacao)) |>
        mutate(
          var_cnae_censo = case_when(
            var_cnae_censo == 14004 ~ 14003, # Extracao de outros minerais nao especificados
            var_cnae_censo == 18999 ~ 18002, # Confecção sob medida de artigos do vestuário e acessórios
            var_cnae_censo == 23400 ~ 23020, # Fabricação de produtos do refino do petróleo
            var_cnae_censo == 45999 ~ 45001, # Atividades de construção em geral
            var_cnae_censo == 53999 ~ 53101, # Comércio varejista realizado em postos móveis, etc.
            var_cnae_censo == 55999 ~ 55010, # Alojamento
            var_cnae_censo == 60999 ~ 60040, # Transporte terrestre de passageiros
            var_cnae_censo == 75999 ~ 75012, # Administração pública estadual
            var_cnae_censo == 80999 ~ 80090, # Outras atividades de ensino
            var_cnae_censo == 85999 ~ 85013, # Outras atividades de saude
            TRUE ~ var_cnae_censo
          )
        )

      # Juncao dos dados
      censo_processing <- censo_processing |>
        left_join(
          dados_cnae[,c(var_cnae_compatibilizacao, "CNAE_Dom2")] |> distinct(),
          by = c(var_cnae_censo = var_cnae_compatibilizacao),
          keep = TRUE,
          relationship = "many-to-many",
          multiple = "first")
    } else{
      # Ajuste de nomes de variaveis

      censo_processing <- dados |>
        select(id_dom, id_pes,
               var_cnae_censo = all_of(var_cnae_censo),
               var_trabalhando = all_of(var_trabalhando),
               var_afastado = all_of(var_afastado),
               var_aprendiz = all_of(var_aprendiz),
               var_trabalho_consumo = all_of(var_trabalho_consumo),
               var_buscou_emprego = all_of(var_buscou_emprego),
               var_posicao_ocupacao = all_of(var_posicao_ocupacao),
               var_codigo_ocupacao = all_of(var_codigo_ocupacao))

      # Ajuste de CNAEs faltantes via tabela relacional
      censo_processing <- censo_processing |>
        left_join(
          dados_ajuste_cnae,
          by = c(var_cnae_censo = "cod_original"),
          keep = TRUE,
          relationship = "many-to-many",
          multiple = "first") |>
        mutate(
          var_cnae_censo = case_when(is.na(cod_ajuste) ~ var_cnae_censo, TRUE ~ cod_ajuste)
        ) |>
        select(-starts_with("cod_"))

      # Juncao dos dados
      censo_processing <- censo_processing |>
        left_join(
          dados_cnae[,var_cnae_compatibilizacao] |> distinct(),
          by = c(var_cnae_censo = var_cnae_compatibilizacao),
          keep = TRUE,
          relationship = "many-to-many",
          multiple = "first")
    }
  } else{
    censo_processing <- censo |>
      select(id_dom, id_pes, CNAE_Dom = var_cnae_censo, all_of(vars))
  }

  # Compatibilizacao da CBO
  if(compatibilizacao_cbo == TRUE){
    if(var_cbo_compatibilizacao == "CBO_Domiciliar"){
      # Ajuste na variavel que sera utilizada na compatibilizacao
      censo_processing <- censo_processing |>
        mutate(
          var_codigo_ocupacao = case_when(
            var_codigo_ocupacao == 1219 ~ 1210, # Diretores de empresas gerais
            var_codigo_ocupacao == 5221 ~ 5199, # Outros trabalhadores dos serviços
            var_codigo_ocupacao == 3162 ~ 3161, # Tecnico em geologia, geotecnologia, etc.
            var_codigo_ocupacao == 2121 ~ 2123, # Especialista em informatica
            var_codigo_ocupacao == 9922 ~ 9921, # Trabalhadores elementares de servico de manutencao
            TRUE ~ var_codigo_ocupacao
          )
        )

      # Juncao dos dados
      censo_processing <- censo_processing |>
        left_join(
          dados_cbo[,c(var_cbo_compatibilizacao, "CBO2002_4d")] |> distinct(),
          by = c(var_codigo_ocupacao = var_cbo_compatibilizacao),
          keep = TRUE,
          relationship = "many-to-many",
          multiple = "first") |>
        mutate(
          CBO2002_4d = case_when(is.na(var_codigo_ocupacao) ~ NA_integer_, TRUE ~ CBO2002_4d)
        )
    } else{
      # Ajuste na variavel que sera utilizada na compatibilizacao
      censo_processing <- censo_processing |>
        left_join(
          dados_ajuste_cbo |> select(starts_with("cod_")),
          by = c(var_codigo_ocupacao = "cod_original"),
          keep = TRUE,
          relationship = "many-to-many",
          multiple = "first") |>
        mutate(
          var_codigo_ocupacao = case_when(is.na(cod_ajuste) ~ var_codigo_ocupacao, TRUE ~ cod_ajuste)
        ) |>
        select(-starts_with("cod_"))

      # Juncao dos dados
      censo_processing <- censo_processing |>
        left_join(
          dados_cbo[,c(var_cbo_compatibilizacao)] |> distinct(),
          by = c(var_codigo_ocupacao = var_cbo_compatibilizacao),
          keep = TRUE,
          relationship = "many-to-many",
          multiple = "first") |>
        mutate(
          CBO2002_4d = case_when(is.na(var_codigo_ocupacao) ~ NA_integer_, TRUE ~ CBO2002_4d)
        )
    }
  }

  # gerando base de controle sobre processo de compatibilizacao
  if(var_cnae_compatibilizacao == "CNAE_Dom"){
    tabela <- censo_processing |>
      mutate(
        sucessos_cnae = case_when(var_cnae_censo == CNAE_Dom ~ 1, TRUE ~ 0),
        sucessos_cbo = case_when(var_codigo_ocupacao == CBO_Domiciliar ~ 1, TRUE ~ 0)
      ) |>
      summarise(
        sucessos_cnae = sum(sucessos_cnae),
        sucessos_cbo = sum(sucessos_cbo),
        valores_validos_cbo = n_distinct(id_pes[!is.na(var_codigo_ocupacao)]),
        valores_validos_cnae = n_distinct(id_pes[!is.na(var_cnae_censo)]),
        perc_sucessos_cnae = round(100*(sucessos_cnae/valores_validos_cnae),2),
        perc_sucessos_cbo = round(100*(sucessos_cbo/valores_validos_cbo),2)
      )
  } else{
    tabela <- censo_processing |>
      mutate(
        sucessos_cnae = case_when(var_cnae_censo == CNAE_Dom2 ~ 1, TRUE ~ 0),
        sucessos_cbo = case_when(var_codigo_ocupacao == CBO2002_4d ~ 1, TRUE ~ 0)
      ) |>
      summarise(
        sucessos_cnae = sum(sucessos_cnae),
        sucessos_cbo = sum(sucessos_cbo),
        valores_validos_cbo = n_distinct(id_pes[!is.na(var_codigo_ocupacao)]),
        valores_validos_cnae = n_distinct(id_pes[!is.na(var_cnae_censo)]),
        perc_sucessos_cnae = round(100*(sucessos_cnae/valores_validos_cnae),2),
        perc_sucessos_cbo = round(100*(sucessos_cbo/valores_validos_cbo),2)
      )
  }

  print(paste0("Começando processo de criacao de variaveis..."))


  # criando variavesi de PEA, PO e PosicaoOcupacao
  if(var_cnae_compatibilizacao == "CNAE_Dom"){
    censo_processing <- censo_processing |>
      mutate(
        PEA = case_when(
          var_trabalhando == 1 ~ 1,
          var_trabalhando != 1 & var_afastado == 1 ~ 1,
          var_trabalhando != 1 & var_aprendiz == 1 ~ 1,
          var_trabalhando != 1 & var_trabalho_cultivo == 1 ~ 1,
          var_trabalhando != 1 & var_trabalho_consumo == 1 ~ 1,
          var_trabalhando != 1 & var_buscou_emprego == 1 ~ 1,
          TRUE ~ 0),
        PO = case_when(
          var_trabalhando == 1 ~ 1,
          var_trabalhando != 1 & var_afastado == 1 ~ 1,
          var_trabalhando != 1 & var_aprendiz == 1 ~ 1,
          var_trabalhando != 1 & var_trabalho_cultivo == 1 ~ 1,
          var_trabalhando != 1 & var_trabalho_consumo == 1 ~ 1,
          var_trabalhando != 1 & var_buscou_emprego == 1 &
            var_afastado != 1 &
            var_aprendiz != 1 &
            var_trabalho_consumo != 1 ~ 0,
          TRUE ~ 0),
        PosicaoOcupacao = case_when(
          var_posicao_ocupacao %in% c(7,8,9) ~ 0, #trabalhador familiar nao remunerado
          var_posicao_ocupacao %in% c(1,2,3,4) ~ 1, #empregado
          var_posicao_ocupacao == 5 ~ 2, #empregador
          var_posicao_ocupacao == 6 ~ 3) #conta propria
      )
  } else{
    censo_processing <- censo_processing |>
      mutate(
        PEA = case_when(
          var_trabalhando == 1 ~ 1,
          var_trabalhando != 1 & var_afastado == 1 ~ 1,
          var_trabalhando != 1 & var_aprendiz == 1 ~ 1,
          var_trabalhando != 1 & var_trabalho_consumo == 1 ~ 1,
          var_trabalhando != 1 & var_buscou_emprego == 1 ~ 1,
          TRUE ~ 0),
        PO = case_when(
          var_trabalhando == 1 ~ 1,
          var_trabalhando != 1 & var_afastado == 1 ~ 1,
          var_trabalhando != 1 & var_aprendiz == 1 ~ 1,
          var_trabalhando != 1 & var_trabalho_consumo == 1 ~ 1,
          var_trabalhando != 1 & var_buscou_emprego == 1 &
            var_afastado != 1 &
            var_aprendiz != 1 &
            var_trabalho_consumo != 1 ~ 0,
          TRUE ~ 0),
        PosicaoOcupacao = case_when(
          var_posicao_ocupacao %in% c(7,8,9) ~ 0, #trabalhador familiar nao remunerado
          var_posicao_ocupacao %in% c(1,2,3,4) ~ 1, #empregado
          var_posicao_ocupacao == 6 ~ 2, #empregador
          var_posicao_ocupacao == 5 ~ 3) #conta propria
      )
  }

  # Processamento das variaveis ISIC, ISCO, EGP
    censo_processing <- censo_processing |>
      mutate(
        ISIC = case_when(
          CNAE_Dom2 == 0 ~ 999, #NA
          CNAE_Dom2 >= 1101 & CNAE_Dom2 <= 3002 ~ 10,
          CNAE_Dom2 >= 5000 & CNAE_Dom2 <= 9000 ~ 20,
          CNAE_Dom2 >= 10010 & CNAE_Dom2 <= 33002 ~ 30,
          CNAE_Dom2 >= 35010 & CNAE_Dom2 <= 39000 ~ 40,
          CNAE_Dom2 >= 41000 & CNAE_Dom2 <= 43000 ~ 50,
          CNAE_Dom2 == 45020 ~ 114,
          CNAE_Dom2 >= 45010 & CNAE_Dom2 <= 48100 ~ 60,
          CNAE_Dom2 >= 49010 & CNAE_Dom2 <= 53002 ~ 80,
          CNAE_Dom2 >= 55000 & CNAE_Dom2 <= 56999 ~ 70,
          CNAE_Dom2 >= 58000 & CNAE_Dom2 <= 60002 ~ 114,
          CNAE_Dom2 == 61000 ~ 80,
          CNAE_Dom2 >= 62000 & CNAE_Dom2 <= 63000 ~ 111,
          CNAE_Dom2 >= 64000 & CNAE_Dom2 <= 66002 ~ 90,
          CNAE_Dom2 >= 68000 & CNAE_Dom2 <= 74000 ~ 111,
          CNAE_Dom2 == 75000 ~ 113,
          CNAE_Dom2 == 77010 | CNAE_Dom2 == 79000 ~ 114,
          CNAE_Dom2 >= 77020 & CNAE_Dom2 <= 82009 ~ 111,
          CNAE_Dom2 >= 84011 & CNAE_Dom2 <= 84020 ~ 100,
          CNAE_Dom2 >= 85011 & CNAE_Dom2 <= 85999 ~ 112,
          CNAE_Dom2 >= 86001 & CNAE_Dom2 <= 88000 ~ 113,
          CNAE_Dom2 == 99000 | CNAE_Dom2 >= 90000 & CNAE_Dom2 <= 96090 ~ 114,
          CNAE_Dom2 == 97000 ~ 120,
          CNAE_Dom2 == 99999 ~ 999 #NA
        )
      )

  # Transformação da CBO em ISCO

    censo_processing <- censo_processing |>
      mutate(
        ISCO = case_when(
          CBO2002_4d %in% c(110:999,5411) ~ 110,
          CBO2002_4d ==1111~1110,
          CBO2002_4d ==1113~1110,
          CBO2002_4d ==1112~1120,
          CBO2002_4d ==1114~1143,
          CBO2002_4d ==1120~1210,
          CBO2002_4d ==1311~1221,
          CBO2002_4d ==1312~1221,
          CBO2002_4d ==1321~1222,
          CBO2002_4d ==1322~1222,
          CBO2002_4d ==1323~1223,
          CBO2002_4d ==1420~1224,
          CBO2002_4d ==1411~1225,
          CBO2002_4d ==1412~1225,
          CBO2002_4d ==1324~1226,
          CBO2002_4d ==1330~1226,
          CBO2002_4d ==1219~1229,
          CBO2002_4d ==1346~1227,
          CBO2002_4d ==1213~1229,
          CBO2002_4d ==1341~1229,
          CBO2002_4d ==1342~1229,
          CBO2002_4d ==1343~1229,
          CBO2002_4d ==1344~1229,
          CBO2002_4d ==1345~1229,
          CBO2002_4d ==1349~1229,
          CBO2002_4d ==1431~1229,
          CBO2002_4d ==1439~1229,
          CBO2002_4d ==1211~1231,
          CBO2002_4d ==1212~1232,
          CBO2002_4d ==1221~1233,
          CBO2002_4d ==1222~1234,
          CBO2002_4d ==1223~1237,
          CBO2002_4d ==2111~2111,
          CBO2002_4d ==2112~2112,
          CBO2002_4d ==2113~2113,
          CBO2002_4d ==2114~2114,
          CBO2002_4d ==2120~2121,
          CBO2002_4d ==2511~2131,
          CBO2002_4d ==2512~2131,
          CBO2002_4d ==2513~2131,
          CBO2002_4d ==2514~2131,
          CBO2002_4d ==2519~2131,
          CBO2002_4d ==2521~2131,
          CBO2002_4d ==2522~2131,
          CBO2002_4d ==2523~2131,
          CBO2002_4d ==2529~2131,
          CBO2002_4d ==2161~2141,
          CBO2002_4d ==2162~2141,
          CBO2002_4d ==2164~2141,
          CBO2002_4d ==2142~2142,
          CBO2002_4d ==2151~2143,
          CBO2002_4d ==2152~2144,
          CBO2002_4d ==2153~2144,
          CBO2002_4d ==2144~2145,
          CBO2002_4d ==2145~2146,
          CBO2002_4d ==2146~2147,
          CBO2002_4d ==2165~2148,
          CBO2002_4d ==2141~2149,
          CBO2002_4d ==2143~2149,
          CBO2002_4d ==2149~2149,
          CBO2002_4d ==2131~2211,
          CBO2002_4d ==2133~2211,
          CBO2002_4d ==2132~2213,
          CBO2002_4d ==2211~2221,
          CBO2002_4d ==2212~2221,
          CBO2002_4d ==2261~2222,
          CBO2002_4d ==2250~2223,
          CBO2002_4d ==2262~2224,
          CBO2002_4d ==2263~2229,
          CBO2002_4d ==2266~2229,
          CBO2002_4d ==2269~2229,
          CBO2002_4d ==2221~2230,
          CBO2002_4d ==2222~2230,
          CBO2002_4d ==2310~2310,
          CBO2002_4d ==2330~2320,
          CBO2002_4d ==2341~2331,
          CBO2002_4d ==2342~2332,
          CBO2002_4d ==2351~2351,
          CBO2002_4d ==2320~2359,
          CBO2002_4d ==2352~2359,
          CBO2002_4d ==2353~2359,
          CBO2002_4d ==2354~2359,
          CBO2002_4d ==2355~2359,
          CBO2002_4d ==2356~2359,
          CBO2002_4d ==2359~2359,
          CBO2002_4d ==3423~2359,
          CBO2002_4d ==5165~2359,
          CBO2002_4d ==2411~2411,
          CBO2002_4d ==2412~2411,
          CBO2002_4d ==2423~2412,
          CBO2002_4d ==2424~2412,
          CBO2002_4d ==2413~2419,
          CBO2002_4d ==2421~2419,
          CBO2002_4d ==2422~2419,
          CBO2002_4d ==2431~2419,
          CBO2002_4d ==2432~2419,
          CBO2002_4d ==2611~2421,
          CBO2002_4d ==2619~2421,
          CBO2002_4d ==2612~2422,
          CBO2002_4d ==2621~2431,
          CBO2002_4d ==2622~2432,
          CBO2002_4d ==2631~2441,
          CBO2002_4d ==2632~2442,
          CBO2002_4d ==2633~2443,
          CBO2002_4d ==2643~2444,
          CBO2002_4d ==2634~2445,
          CBO2002_4d ==2635~2446,
          CBO2002_4d ==2641~2451,
          CBO2002_4d ==2642~2451,
          CBO2002_4d ==2651~2452,
          CBO2002_4d ==2652~2453,
          CBO2002_4d ==2653~2454,
          CBO2002_4d ==2654~2455,
          CBO2002_4d ==2655~2455,
          CBO2002_4d ==2659~2455,
          CBO2002_4d ==2636~2460,
          CBO2002_4d ==3111~3111,
          CBO2002_4d ==3139~3111,
          CBO2002_4d ==3112~3112,
          CBO2002_4d ==3113~3113,
          CBO2002_4d ==3114~3114,
          CBO2002_4d ==3522~3114,
          CBO2002_4d ==3115~3115,
          CBO2002_4d ==3116~3116,
          CBO2002_4d ==3117~3117,
          CBO2002_4d ==3118~3118,
          CBO2002_4d ==3119~3119,
          CBO2002_4d ==3511~3121,
          CBO2002_4d ==3512~3121,
          CBO2002_4d ==3513~3121,
          CBO2002_4d ==3514~3121,
          CBO2002_4d ==3431~3131,
          CBO2002_4d ==3521~3131,
          CBO2002_4d ==3211~3133,
          CBO2002_4d ==3151~3141,
          CBO2002_4d ==3152~3142,
          CBO2002_4d ==3153~3143,
          CBO2002_4d ==3154~3144,
          CBO2002_4d ==3155~3145,
          CBO2002_4d ==3257~3152,
          CBO2002_4d ==7543~3152,
          CBO2002_4d ==3141~3211,
          CBO2002_4d ==3212~3211,
          CBO2002_4d ==3142~3212,
          CBO2002_4d ==3143~3212,
          CBO2002_4d ==2240~3221,
          CBO2002_4d ==3256~3221,
          CBO2002_4d ==3252~3222,
          CBO2002_4d ==2265~3223,
          CBO2002_4d ==2267~3224,
          CBO2002_4d ==3254~3224,
          CBO2002_4d ==3214~3225,
          CBO2002_4d ==3251~3225,
          CBO2002_4d ==2264~3226,
          CBO2002_4d ==3255~3226,
          CBO2002_4d ==3240~3227,
          CBO2002_4d ==3213~3228,
          CBO2002_4d ==3259~3229,
          CBO2002_4d ==3221~3231,
          CBO2002_4d ==3222~3232,
          CBO2002_4d ==2230~3241,
          CBO2002_4d ==3230~3241,
          CBO2002_4d ==3413~3242,
          CBO2002_4d ==3311~3411,
          CBO2002_4d ==3312~3411,
          CBO2002_4d ==3321~3412,
          CBO2002_4d ==3334~3413,
          CBO2002_4d ==4221~3414,
          CBO2002_4d ==2433~3415,
          CBO2002_4d ==2434~3415,
          CBO2002_4d ==3322~3415,
          CBO2002_4d ==3339~3415,
          CBO2002_4d ==3323~3416,
          CBO2002_4d ==3315~3417,
          CBO2002_4d ==3324~3421,
          CBO2002_4d ==3331~3422,
          CBO2002_4d ==3351~3422,
          CBO2002_4d ==3333~3423,
          CBO2002_4d ==3341~3431,
          CBO2002_4d ==3342~3431,
          CBO2002_4d ==3343~3431,
          CBO2002_4d ==3344~3431,
          CBO2002_4d ==3411~3432,
          CBO2002_4d ==3313~3433,
          CBO2002_4d ==3314~3434,
          CBO2002_4d ==3332~3439,
          CBO2002_4d ==3433~3439,
          CBO2002_4d ==3435~3439,
          CBO2002_4d ==3352~3442,
          CBO2002_4d ==3353~3443,
          CBO2002_4d ==3354~3444,
          CBO2002_4d ==3359~3444,
          CBO2002_4d ==3355~3450,
          CBO2002_4d ==3412~3460,
          CBO2002_4d ==2163~3471,
          CBO2002_4d ==2166~3471,
          CBO2002_4d ==3432~3471,
          CBO2002_4d ==2656~3472,
          CBO2002_4d ==3421~3475,
          CBO2002_4d ==3422~3475,
          CBO2002_4d ==4131~4111,
          CBO2002_4d ==4132~4113,
          CBO2002_4d ==4120~4115,
          CBO2002_4d ==4211~4121,
          CBO2002_4d ==4311~4121,
          CBO2002_4d ==4313~4121,
          CBO2002_4d ==4227~4122,
          CBO2002_4d ==4312~4122,
          CBO2002_4d ==4321~4131,
          CBO2002_4d ==4322~4132,
          CBO2002_4d ==4323~4133,
          CBO2002_4d ==4411~4141,
          CBO2002_4d ==4415~4141,
          CBO2002_4d ==4412~4142,
          CBO2002_4d ==4413~4143,
          CBO2002_4d ==4414~4144,
          CBO2002_4d ==4110~4190,
          CBO2002_4d ==4416~4190,
          CBO2002_4d ==4419~4190,
          CBO2002_4d ==5230~4211,
          CBO2002_4d ==4212~4212,
          CBO2002_4d ==4213~4214,
          CBO2002_4d ==4214~4215,
          CBO2002_4d ==4224~4222,
          CBO2002_4d ==4225~4222,
          CBO2002_4d ==4226~4222,
          CBO2002_4d ==4229~4222,
          CBO2002_4d ==4222~4223,
          CBO2002_4d ==4223~4223,
          CBO2002_4d ==5111~5111,
          CBO2002_4d ==5112~5112,
          CBO2002_4d ==8331~5112,
          CBO2002_4d ==5113~5113,
          CBO2002_4d ==5151~5121,
          CBO2002_4d ==5152~5121,
          CBO2002_4d ==3434~5122,
          CBO2002_4d ==5120~5122,
          CBO2002_4d ==9411~5122,
          CBO2002_4d ==9412~5122,
          CBO2002_4d ==5131~5123,
          CBO2002_4d ==5132~5123,
          CBO2002_4d ==5311~5131,
          CBO2002_4d ==5312~5131,
          CBO2002_4d ==3258~5132,
          CBO2002_4d ==5321~5132,
          CBO2002_4d ==5329~5132,
          CBO2002_4d ==5322~5133,
          CBO2002_4d ==3253~5139,
          CBO2002_4d ==5164~5139,
          CBO2002_4d ==5141~5141,
          CBO2002_4d ==5142~5141,
          CBO2002_4d ==5162~5142,
          CBO2002_4d ==5163~5143,
          CBO2002_4d ==5169~5149,
          CBO2002_4d ==5161~5151,
          CBO2002_4d ==5412~5162,
          CBO2002_4d ==5413~5163,
          CBO2002_4d ==5414~9152,
          CBO2002_4d ==5419~5169,
          CBO2002_4d ==5241~5210,
          CBO2002_4d ==5221~5220,
          CBO2002_4d ==5222~5220,
          CBO2002_4d ==5223~5220,
          CBO2002_4d ==5242~5220,
          CBO2002_4d ==5245~5220,
          CBO2002_4d ==5246~5220,
          CBO2002_4d ==5249~5220,
          CBO2002_4d ==5211~5230,
          CBO2002_4d ==6111~6111,
          CBO2002_4d ==6114~6111,
          CBO2002_4d ==6112~6113,
          CBO2002_4d ==9214~9211,
          CBO2002_4d ==6121~6121,
          CBO2002_4d ==6122~6122,
          CBO2002_4d ==6123~6123,
          CBO2002_4d ==6129~6129,
          CBO2002_4d ==6130~6141,
          CBO2002_4d ==6210~6141,
          CBO2002_4d ==9215~9212,
          CBO2002_4d ==6221~6151,
          CBO2002_4d ==6225~6152,
          CBO2002_4d ==6224~6154,
          CBO2002_4d ==9216~9212,
          CBO2002_4d ==3121~7111,
          CBO2002_4d ==8111~7111,
          CBO2002_4d ==7542~7112,
          CBO2002_4d ==7113~7113,
          CBO2002_4d ==7111~7122,
          CBO2002_4d ==7112~7122,
          CBO2002_4d ==9312~7122,
          CBO2002_4d ==9313~7122,
          CBO2002_4d ==7114~7123,
          CBO2002_4d ==7115~7124,
          CBO2002_4d ==3123~7129,
          CBO2002_4d ==7119~7129,
          CBO2002_4d ==7121~7131,
          CBO2002_4d ==7122~7132,
          CBO2002_4d ==7123~7133,
          CBO2002_4d ==7124~7134,
          CBO2002_4d ==7125~7135,
          CBO2002_4d ==7126~7136,
          CBO2002_4d ==7411~7137,
          CBO2002_4d ==7131~7141,
          CBO2002_4d ==7132~7142,
          CBO2002_4d ==7133~7143,
          CBO2002_4d ==7544~7143,
          CBO2002_4d ==7211~7211,
          CBO2002_4d ==7212~7212,
          CBO2002_4d ==7213~7213,
          CBO2002_4d ==7214~7214,
          CBO2002_4d ==7215~7215,
          CBO2002_4d ==7541~7216,
          CBO2002_4d ==7221~7221,
          CBO2002_4d ==7222~7222,
          CBO2002_4d ==7223~7223,
          CBO2002_4d ==7224~7224,
          CBO2002_4d ==7231~7231,
          CBO2002_4d ==7234~7231,
          CBO2002_4d ==7232~7232,
          CBO2002_4d ==7127~7233,
          CBO2002_4d ==7233~7233,
          CBO2002_4d ==7412~7241,
          CBO2002_4d ==7421~7242,
          CBO2002_4d ==7422~7244,
          CBO2002_4d ==7413~7245,
          CBO2002_4d ==7311~7311,
          CBO2002_4d ==7312~7312,
          CBO2002_4d ==7313~7313,
          CBO2002_4d ==7314~7321,
          CBO2002_4d ==7315~7322,
          CBO2002_4d ==7316~7324,
          CBO2002_4d ==7317~7331,
          CBO2002_4d ==7319~7331,
          CBO2002_4d ==7549~7331,
          CBO2002_4d ==7318~7332,
          CBO2002_4d ==7321~7341,
          CBO2002_4d ==8132~7344,
          CBO2002_4d ==7323~7345,
          CBO2002_4d ==7511~7411,
          CBO2002_4d ==7512~7412,
          CBO2002_4d ==7513~7413,
          CBO2002_4d ==7514~7414,
          CBO2002_4d ==7515~7415,
          CBO2002_4d ==7516~7416,
          CBO2002_4d ==7521~7421,
          CBO2002_4d ==7522~7422,
          CBO2002_4d ==7523~7423,
          CBO2002_4d ==8152~8262,
          CBO2002_4d ==7531~7433,
          CBO2002_4d ==7532~7435,
          CBO2002_4d ==7533~7436,
          CBO2002_4d ==7534~7437,
          CBO2002_4d ==7535~7441,
          CBO2002_4d ==7536~7442,
          CBO2002_4d ==8112~8112,
          CBO2002_4d ==8113~8113,
          CBO2002_4d ==3135~8121,
          CBO2002_4d ==8121~8121,
          CBO2002_4d ==8181~8131,
          CBO2002_4d ==8172~8141,
          CBO2002_4d ==8171~8142,
          CBO2002_4d ==8131~8151,
          CBO2002_4d ==3133~8152,
          CBO2002_4d ==3134~8155,
          CBO2002_4d ==3131~8161,
          CBO2002_4d ==8182~8162,
          CBO2002_4d ==3132~8163,
          CBO2002_4d ==3122~8171,
          CBO2002_4d ==8114~8212,
          CBO2002_4d ==8122~8223,
          CBO2002_4d ==8141~8231,
          CBO2002_4d ==8142~8232,
          CBO2002_4d ==7322~8251,
          CBO2002_4d ==8143~8253,
          CBO2002_4d ==8151~8261,
          CBO2002_4d ==8153~8263,
          CBO2002_4d ==8154~8264,
          CBO2002_4d ==8157~8264,
          CBO2002_4d ==8155~8265,
          CBO2002_4d ==8156~8266,
          CBO2002_4d ==8159~8269,
          CBO2002_4d ==8160~8271,
          CBO2002_4d ==8211~8281,
          CBO2002_4d ==8212~8282,
          CBO2002_4d ==8189~8290,
          CBO2002_4d ==8219~8290,
          CBO2002_4d ==8311~8311,
          CBO2002_4d ==8312~8312,
          CBO2002_4d ==8321~8321,
          CBO2002_4d ==8322~8322,
          CBO2002_4d ==8332~8324,
          CBO2002_4d ==8341~8331,
          CBO2002_4d ==8342~8332,
          CBO2002_4d ==8343~8333,
          CBO2002_4d ==8344~8334,
          CBO2002_4d ==8350~8340,
          CBO2002_4d ==5212~9111,
          CBO2002_4d ==9520~9112,
          CBO2002_4d ==5243~9113,
          CBO2002_4d ==5244~9113,
          CBO2002_4d ==9510~9120,
          CBO2002_4d ==9111~9131,
          CBO2002_4d ==9112~9132,
          CBO2002_4d ==9129~9132,
          CBO2002_4d ==9121~9133,
          CBO2002_4d ==9122~9142,
          CBO2002_4d ==9123~9142,
          CBO2002_4d ==9621~9151,
          CBO2002_4d ==5153~9141,
          CBO2002_4d ==9623~9153,
          CBO2002_4d ==9611~9161,
          CBO2002_4d ==9612~9161,
          CBO2002_4d ==9613~9162,
          CBO2002_4d ==9622~9162,
          CBO2002_4d ==9624~9162,
          CBO2002_4d ==9211~9211,
          CBO2002_4d ==9212~9211,
          CBO2002_4d ==9213~9211,
          CBO2002_4d ==9311~9311,
          CBO2002_4d ==9329~9321,
          CBO2002_4d ==8183~9322,
          CBO2002_4d ==9321~9322,
          CBO2002_4d ==9331~9331,
          CBO2002_4d ==9332~9332,
          CBO2002_4d ==9333~9333,
          CBO2002_4d ==9334~9333,
          CBO2002_4d ==9629~999,
          CBO2002_4d ==9999~999,
          CBO2002_4d ==9998~999,
          CBO2002_4d ==9988~999,
          CBO2002_4d == 0 | CBO2002_4d == 5168 ~ 999
        )
      ) |>
      mutate(ISCO = case_when(
        ISCO == 6122 & PosicaoOcupacao == 2 ~ 1311,
        ISCO %in% c(1143,1210,1221:1227,1229,1231:1234,1237) & ISIC == 100 &
          PosicaoOcupacao == 3 ~ 1120,
        ISCO %in% c(9211, 6113) & ISIC %in% c(114, 120) ~ 9141,
        PosicaoOcupacao == 1 & ISCO %in% c(6111, 6113, 6123, 6129) ~ 9211,
        PosicaoOcupacao == 1 & ISCO %in% c(6121, 6122) ~ 9211,
        PosicaoOcupacao == 1 & ISCO %in% c( 6141, 6142) ~ 9212,
        PosicaoOcupacao == 1 & ISCO %in% c(6151:6154) ~ 9213,
        PosicaoOcupacao == 1 & ISCO %in% c(6111, 6113, 6123, 6129) ~ 1311,
        TRUE ~ ISCO))

  # Transformacao da ISCO em EGP11
  censo_processing <- censo_processing |>
    mutate(
      EGP11 = case_when(
        ISCO == 1110 ~ 1,
        ISCO == 1120 ~ 1,
        ISCO == 1130 ~ 1,
        ISCO == 1210 ~ 1,
        ISCO == 1222 ~ 1,
        ISCO == 1223 ~ 1,
        ISCO == 1224 ~ 1,
        ISCO == 1225 ~ 1,
        ISCO == 1226 ~ 1,
        ISCO == 1227 ~ 1,
        ISCO == 1228 ~ 1,
        ISCO == 1229 ~ 1,
        ISCO == 1231 ~ 1,
        ISCO == 1232 ~ 1,
        ISCO == 1233 ~ 1,
        ISCO == 1234 ~ 1,
        ISCO == 1235 ~ 1,
        ISCO == 1236 ~ 1,
        ISCO == 1237 ~ 1,
        ISCO == 1239 ~ 1,
        ISCO == 2111 ~ 1,
        ISCO == 2112 ~ 1,
        ISCO == 2113 ~ 1,
        ISCO == 2114 ~ 1,
        ISCO == 2121 ~ 1,
        ISCO == 2122 ~ 1,
        ISCO == 2131 ~ 1,
        ISCO == 2141 ~ 1,
        ISCO == 2142 ~ 1,
        ISCO == 2143 ~ 1,
        ISCO == 2144 ~ 1,
        ISCO == 2145 ~ 1,
        ISCO == 2146 ~ 1,
        ISCO == 2147 ~ 1,
        ISCO == 2148 ~ 1,
        ISCO == 2149 ~ 1,
        ISCO == 2211 ~ 1,
        ISCO == 2212 ~ 1,
        ISCO == 2213 ~ 1,
        ISCO == 2221 ~ 1,
        ISCO == 2222 ~ 1,
        ISCO == 2223 ~ 1,
        ISCO == 2224 ~ 1,
        ISCO == 2229 ~ 1,
        ISCO == 2310 ~ 1,
        ISCO == 2351 ~ 1,
        ISCO == 1000 ~ 1,
        ISCO == 1100 ~ 1,
        ISCO == 1200 ~ 1,
        ISCO == 1220 ~ 1,
        ISCO == 1230 ~ 1,
        ISCO == 1250 ~ 1,
        ISCO == 1251 ~ 1,
        ISCO == 2000 ~ 1,
        ISCO == 2100 ~ 1,
        ISCO == 2110 ~ 1,
        ISCO == 2120 ~ 1,
        ISCO == 2130 ~ 1,
        ISCO == 2140 ~ 1,
        ISCO == 2200 ~ 1,
        ISCO == 2210 ~ 1,
        ISCO == 2220 ~ 1,
        ISCO == 2350 ~ 1,
        ISCO == 2400 ~ 1,
        ISCO == 2420 ~ 1,
        ISCO == 2440 ~ 1,
        ISCO == 2352 ~ 2,
        ISCO == 2411 ~ 1,
        ISCO == 2421 ~ 1,
        ISCO == 2422 ~ 1,
        ISCO == 2429 ~ 1,
        ISCO == 2441 ~ 1,
        ISCO == 2442 ~ 1,
        ISCO == 2443 ~ 1,
        ISCO == 2445 ~ 1,
        ISCO == 3143 ~ 1,
        ISCO == 3144 ~ 2,
        ISCO == 2452 ~ 2,
        ISCO == 5151 ~ 2,
        ISCO == 2453 ~ 2,
        ISCO == 2460 ~ 2,
        ISCO == 3232 ~ 2,
        ISCO == 1143 ~ 2,
        ISCO == 3472 ~ 2,
        ISCO == 3471 ~ 2,
        ISCO == 3417 ~ 2,
        ISCO == 3413 ~ 2,
        ISCO == 3415 ~ 2,
        ISCO == 3225 ~ 2,
        ISCO == 2431 ~ 2,
        ISCO == 3231 ~ 2,
        ISCO == 2455 ~ 2,
        ISCO == 3224 ~ 2,
        ISCO == 3416 ~ 2,
        ISCO == 3475 ~ 2,
        ISCO == 3431 ~ 2,
        ISCO == 3411 ~ 2,
        ISCO == 3122 ~ 2,
        ISCO == 2419 ~ 2,
        ISCO == 3450 ~ 2,
        ISCO == 3434 ~ 2,
        ISCO == 2446 ~ 2,
        ISCO == 3449 ~ 2,
        ISCO == 3432 ~ 2,
        ISCO == 2444 ~ 2,
        ISCO == 3422 ~ 2,
        ISCO == 3228 ~ 2,
        ISCO == 2451 ~ 2,
        ISCO == 3423 ~ 2,
        ISCO == 3227 ~ 2,
        ISCO == 3226 ~ 2,
        ISCO == 2230 ~ 2,
        ISCO == 2320 ~ 2,
        ISCO == 1141 ~ 2,
        ISCO == 1142 ~ 2,
        ISCO == 1312 ~ 2,
        ISCO == 1313 ~ 2,
        ISCO == 1314 ~ 2,
        ISCO == 1315 ~ 2,
        ISCO == 1316 ~ 2,
        ISCO == 1317 ~ 2,
        ISCO == 1318 ~ 2,
        ISCO == 1319 ~ 2,
        ISCO == 2132 ~ 2,
        ISCO == 2139 ~ 2,
        ISCO == 2340 ~ 2,
        ISCO == 2412 ~ 2,
        ISCO == 2454 ~ 2,
        ISCO == 3121 ~ 2,
        ISCO == 3221 ~ 2,
        ISCO == 3222 ~ 2,
        ISCO == 3223 ~ 2,
        ISCO == 3229 ~ 2,
        ISCO == 3241 ~ 2,
        ISCO == 3242 ~ 2,
        ISCO == 3310 ~ 2,
        ISCO == 3320 ~ 2,
        ISCO == 3412 ~ 2,
        ISCO == 3414 ~ 2,
        ISCO == 3419 ~ 2,
        ISCO == 3421 ~ 2,
        ISCO == 3429 ~ 2,
        ISCO == 3441 ~ 2,
        ISCO == 3442 ~ 2,
        ISCO == 3443 ~ 2,
        ISCO == 3444 ~ 2,
        ISCO == 3473 ~ 2,
        ISCO == 3474 ~ 2,
        ISCO == 5152 ~ 2,
        ISCO == 1140 ~ 2,
        ISCO == 1240 ~ 2,
        ISCO == 1252 ~ 2,
        ISCO == 1300 ~ 2,
        ISCO == 1310 ~ 2,
        ISCO == 2300 ~ 2,
        ISCO == 2321 ~ 2,
        ISCO == 2322 ~ 2,
        ISCO == 2323 ~ 2,
        ISCO == 2330 ~ 2,
        ISCO == 2410 ~ 2,
        ISCO == 2430 ~ 2,
        ISCO == 2450 ~ 2,
        ISCO == 3000 ~ 2,
        ISCO == 3100 ~ 2,
        ISCO == 3110 ~ 2,
        ISCO == 3120 ~ 2,
        ISCO == 3130 ~ 2,
        ISCO == 3140 ~ 2,
        ISCO == 3150 ~ 2,
        ISCO == 3200 ~ 2,
        ISCO == 3210 ~ 2,
        ISCO == 3220 ~ 2,
        ISCO == 3240 ~ 2,
        ISCO == 3400 ~ 2,
        ISCO == 3410 ~ 2,
        ISCO == 3420 ~ 2,
        ISCO == 3440 ~ 2,
        ISCO == 3451 ~ 2,
        ISCO == 3470 ~ 2,
        ISCO == 5150 ~ 2,
        ISCO == 2332 ~ 3,
        ISCO == 2331 ~ 3,
        ISCO == 2359 ~ 3,
        ISCO == 2432 ~ 3,
        ISCO == 5112 ~ 3,
        ISCO == 4132 ~ 3,
        ISCO == 4131 ~ 3,
        ISCO == 5113 ~ 3,
        ISCO == 4215 ~ 3,
        ISCO == 3340 ~ 3,
        ISCO == 4133 ~ 3,
        ISCO == 5210 ~ 3,
        ISCO == 5111 ~ 3,
        ISCO == 4141 ~ 3,
        ISCO == 4111 ~ 3,
        ISCO == 5162 ~ 3,
        ISCO == 4115 ~ 3,
        ISCO == 4121 ~ 3,
        ISCO == 3439 ~ 3,
        ISCO == 3433 ~ 3,
        ISCO == 4122 ~ 3,
        ISCO == 3330 ~ 3,
        ISCO == 3460 ~ 3,
        ISCO == 3480 ~ 3,
        ISCO == 4112 ~ 3,
        ISCO == 4113 ~ 3,
        ISCO == 4114 ~ 3,
        ISCO == 4143 ~ 3,
        ISCO == 4144 ~ 3,
        ISCO == 4190 ~ 3,
        ISCO == 4212 ~ 3,
        ISCO == 4214 ~ 3,
        ISCO == 4221 ~ 3,
        ISCO == 5161 ~ 3,
        ISCO == 3230 ~ 3,
        ISCO == 3300 ~ 3,
        ISCO == 3430 ~ 3,
        ISCO == 4000 ~ 3,
        ISCO == 4100 ~ 3,
        ISCO == 4110 ~ 3,
        ISCO == 4120 ~ 3,
        ISCO == 4130 ~ 3,
        ISCO == 4140 ~ 3,
        ISCO == 4200 ~ 3,
        ISCO == 4210 ~ 3,
        ISCO == 4220 ~ 3,
        ISCO == 5000 ~ 3,
        ISCO == 5100 ~ 3,
        ISCO == 5110 ~ 3,
        ISCO == 5120 ~ 3,
        ISCO == 5130 ~ 3,
        ISCO == 5200 ~ 3,
        ISCO == 9100 ~ 3,
        ISCO == 9110 ~ 3,
        ISCO == 4213 ~ 4,
        ISCO == 5149 ~ 4,
        ISCO == 9152 ~ 4,
        ISCO == 5123 ~ 4,
        ISCO == 9113 ~ 4,
        ISCO == 9151 ~ 4,
        ISCO == 5220 ~ 4,
        ISCO == 4211 ~ 4,
        ISCO == 5139 ~ 4,
        ISCO == 4142 ~ 4,
        ISCO == 4222 ~ 4,
        ISCO == 4223 ~ 4,
        ISCO == 5132 ~ 4,
        ISCO == 5142 ~ 4,
        ISCO == 3452 ~ 7,
        ISCO == 7510 ~ 7,
        ISCO == 5140 ~ 8,
        ISCO == 5164 ~ 8,
        ISCO == 7000 ~ 8,
        ISCO == 7100 ~ 8,
        ISCO == 7110 ~ 8,
        ISCO == 7120 ~ 8,
        ISCO == 7130 ~ 8,
        ISCO == 7140 ~ 8,
        ISCO == 7200 ~ 8,
        ISCO == 7210 ~ 8,
        ISCO == 7220 ~ 8,
        ISCO == 7230 ~ 8,
        ISCO == 7240 ~ 8,
        ISCO == 7300 ~ 8,
        ISCO == 7310 ~ 8,
        ISCO == 7340 ~ 8,
        ISCO == 7400 ~ 8,
        ISCO == 7410 ~ 8,
        ISCO == 7420 ~ 8,
        ISCO == 7430 ~ 8,
        ISCO == 7440 ~ 8,
        ISCO == 7500 ~ 8,
        ISCO == 7520 ~ 8,
        ISCO == 8110 ~ 8,
        ISCO == 8120 ~ 8,
        ISCO == 8150 ~ 8,
        ISCO == 8160 ~ 8,
        ISCO == 8170 ~ 8,
        ISCO == 8210 ~ 8,
        ISCO == 5143 ~ 8,
        ISCO == 3142 ~ 8,
        ISCO == 7216 ~ 8,
        ISCO == 7242 ~ 8,
        ISCO == 7313 ~ 8,
        ISCO == 7243 ~ 8,
        ISCO == 7312 ~ 8,
        ISCO == 7233 ~ 8,
        ISCO == 7311 ~ 8,
        ISCO == 3115 ~ 8,
        ISCO == 3113 ~ 8,
        ISCO == 3131 ~ 8,
        ISCO == 7245 ~ 8,
        ISCO == 3117 ~ 8,
        ISCO == 7241 ~ 8,
        ISCO == 7222 ~ 8,
        ISCO == 7344 ~ 8,
        ISCO == 3112 ~ 8,
        ISCO == 7343 ~ 8,
        ISCO == 3114 ~ 8,
        ISCO == 3211 ~ 8,
        ISCO == 3132 ~ 8,
        ISCO == 3152 ~ 8,
        ISCO == 3116 ~ 8,
        ISCO == 3111 ~ 8,
        ISCO == 8151 ~ 8,
        ISCO == 3118 ~ 8,
        ISCO == 7232 ~ 8,
        ISCO == 3212 ~ 8,
        ISCO == 8311 ~ 8,
        ISCO == 3133 ~ 8,
        ISCO == 3119 ~ 8,
        ISCO == 8159 ~ 8,
        ISCO == 3123 ~ 8,
        ISCO == 3139 ~ 8,
        ISCO == 3141 ~ 8,
        ISCO == 3145 ~ 8,
        ISCO == 3151 ~ 8,
        ISCO == 3213 ~ 8,
        ISCO == 1221 ~ 9,
        ISCO == 5160 ~ 9,
        ISCO == 7234 ~ 9,
        ISCO == 7320 ~ 9,
        ISCO == 7330 ~ 9,
        ISCO == 7530 ~ 9,
        ISCO == 8000 ~ 9,
        ISCO == 8100 ~ 9,
        ISCO == 8130 ~ 9,
        ISCO == 8140 ~ 9,
        ISCO == 8200 ~ 9,
        ISCO == 8220 ~ 9,
        ISCO == 8230 ~ 9,
        ISCO == 8250 ~ 9,
        ISCO == 8260 ~ 9,
        ISCO == 8270 ~ 9,
        ISCO == 8280 ~ 9,
        ISCO == 8300 ~ 9,
        ISCO == 8310 ~ 9,
        ISCO == 8320 ~ 9,
        ISCO == 8330 ~ 9,
        ISCO == 8400 ~ 9,
        ISCO == 9000 ~ 9,
        ISCO == 9130 ~ 9,
        ISCO == 9140 ~ 9,
        ISCO == 9150 ~ 9,
        ISCO == 9160 ~ 9,
        ISCO == 9300 ~ 9,
        ISCO == 9310 ~ 9,
        ISCO == 9320 ~ 9,
        ISCO == 9330 ~ 9,
        ISCO == 1311 ~ 9,
        ISCO == 7424 ~ 9,
        ISCO == 7132 ~ 9,
        ISCO == 7321 ~ 9,
        ISCO == 8276 ~ 9,
        ISCO == 8112 ~ 9,
        ISCO == 7124 ~ 9,
        ISCO == 7122 ~ 9,
        ISCO == 8141 ~ 9,
        ISCO == 8340 ~ 9,
        ISCO == 7129 ~ 8,
        ISCO == 7123 ~ 9,
        ISCO == 8277 ~ 9,
        ISCO == 8332 ~ 9,
        ISCO == 7416 ~ 9,
        ISCO == 7432 ~ 9,
        ISCO == 8212 ~ 9,
        ISCO == 8278 ~ 9,
        ISCO == 8111 ~ 9,
        ISCO == 8271 ~ 9,
        ISCO == 7136 ~ 9,
        ISCO == 7113 ~ 9,
        ISCO == 5122 ~ 9,
        ISCO == 7141 ~ 9,
        ISCO == 7423 ~ 9,
        ISCO == 7214 ~ 9,
        ISCO == 8324 ~ 9,
        ISCO == 7441 ~ 9,
        ISCO == 7133 ~ 9,
        ISCO == 7411 ~ 9,
        ISCO == 7436 ~ 9,
        ISCO == 7422 ~ 9,
        ISCO == 8142 ~ 9,
        ISCO == 7431 ~ 9,
        ISCO == 8162 ~ 9,
        ISCO == 7412 ~ 9,
        ISCO == 8139 ~ 9,
        ISCO == 7435 ~ 9,
        ISCO == 7442 ~ 9,
        ISCO == 8262 ~ 9,
        ISCO == 8153 ~ 9,
        ISCO == 7231 ~ 9,
        ISCO == 8272 ~ 9,
        ISCO == 7213 ~ 9,
        ISCO == 8121 ~ 9,
        ISCO == 7134 ~ 9,
        ISCO == 8231 ~ 9,
        ISCO == 8333 ~ 9,
        ISCO == 8222 ~ 9,
        ISCO == 7135 ~ 9,
        ISCO == 8266 ~ 9,
        ISCO == 8223 ~ 9,
        ISCO == 8124 ~ 9,
        ISCO == 8322 ~ 9,
        ISCO == 7212 ~ 9,
        ISCO == 7421 ~ 9,
        ISCO == 7224 ~ 9,
        ISCO == 7137 ~ 9,
        ISCO == 8261 ~ 9,
        ISCO == 8122 ~ 9,
        ISCO == 8163 ~ 9,
        ISCO == 7211 ~ 9,
        ISCO == 7221 ~ 9,
        ISCO == 7345 ~ 9,
        ISCO == 8269 ~ 9,
        ISCO == 8152 ~ 9,
        ISCO == 7215 ~ 9,
        ISCO == 5141 ~ 9,
        ISCO == 8232 ~ 9,
        ISCO == 7322 ~ 9,
        ISCO == 8281 ~ 9,
        ISCO == 8264 ~ 9,
        ISCO == 7324 ~ 9,
        ISCO == 7131 ~ 9,
        ISCO == 8143 ~ 9,
        ISCO == 7341 ~ 9,
        ISCO == 8312 ~ 9,
        ISCO == 8113 ~ 9,
        ISCO == 8161 ~ 9,
        ISCO == 8253 ~ 9,
        ISCO == 5163 ~ 9,
        ISCO == 8251 ~ 9,
        ISCO == 7332 ~ 9,
        ISCO == 8240 ~ 9,
        ISCO == 7223 ~ 9,
        ISCO == 7433 ~ 9,
        ISCO == 8252 ~ 9,
        ISCO == 8283 ~ 9,
        ISCO == 5169 ~ 9,
        ISCO == 7415 ~ 9,
        ISCO == 7244 ~ 9,
        ISCO == 8221 ~ 9,
        ISCO == 8290 ~ 9,
        ISCO == 8155 ~ 8,
        ISCO == 8172 ~ 9,
        ISCO == 8154 ~ 8,
        ISCO == 7112 ~ 9,
        ISCO == 7121 ~ 9,
        ISCO == 7142 ~ 9,
        ISCO == 7143 ~ 9,
        ISCO == 7323 ~ 9,
        ISCO == 7331 ~ 9,
        ISCO == 7342 ~ 9,
        ISCO == 7346 ~ 9,
        ISCO == 7413 ~ 9,
        ISCO == 7414 ~ 9,
        ISCO == 7434 ~ 9,
        ISCO == 7437 ~ 9,
        ISCO == 8123 ~ 9,
        ISCO == 8131 ~ 9,
        ISCO == 8171 ~ 9,
        ISCO == 8211 ~ 9,
        ISCO == 8224 ~ 9,
        ISCO == 8229 ~ 9,
        ISCO == 8263 ~ 9,
        ISCO == 8265 ~ 9,
        ISCO == 8274 ~ 9,
        ISCO == 8275 ~ 9,
        ISCO == 8279 ~ 9,
        ISCO == 8282 ~ 9,
        ISCO == 8284 ~ 9,
        ISCO == 8285 ~ 9,
        ISCO == 8286 ~ 9,
        ISCO == 8321 ~ 9,
        ISCO == 8323 ~ 9,
        ISCO == 8334 ~ 9,
        ISCO == 9153 ~ 9,
        ISCO == 9313 ~ 9,
        ISCO == 8273 ~ 10,
        ISCO == 9120 ~ 10,
        ISCO == 9162 ~ 10,
        ISCO == 9311 ~ 10,
        ISCO == 9312 ~ 10,
        ISCO == 9321 ~ 10,
        ISCO == 5121 ~ 10,
        ISCO == 5131 ~ 10,
        ISCO == 5133 ~ 10,
        ISCO == 5230 ~ 10,
        ISCO == 9111 ~ 10,
        ISCO == 9112 ~ 10,
        ISCO == 9131 ~ 10,
        ISCO == 9132 ~ 10,
        ISCO == 9133 ~ 10,
        ISCO == 9141 ~ 10,
        ISCO == 9142 ~ 10,
        ISCO == 9161 ~ 10,
        ISCO == 9322 ~ 10,
        ISCO == 9331 ~ 10,
        ISCO == 9332 ~ 10,
        ISCO == 9333 ~ 10,
        ISCO == 7111 ~ 10,
        ISCO == 6000 ~ 10,
        ISCO == 6100 ~ 10,
        ISCO == 6110 ~ 10,
        ISCO == 6120 ~ 10,
        ISCO == 6134 ~ 10,
        ISCO == 6140 ~ 10,
        ISCO == 6150 ~ 10,
        ISCO == 9200 ~ 10,
        ISCO == 9210 ~ 10,
        ISCO == 6111 ~ 11,
        ISCO == 6112 ~ 11,
        ISCO == 6113 ~ 11,
        ISCO == 6114 ~ 11,
        ISCO == 6121 ~ 11,
        ISCO == 6122 ~ 11,
        ISCO == 6123 ~ 11,
        ISCO == 6124 ~ 11,
        ISCO == 6129 ~ 11,
        ISCO == 6130 ~ 11,
        ISCO == 6141 ~ 11,
        ISCO == 6142 ~ 11,
        ISCO == 6151 ~ 11,
        ISCO == 6152 ~ 11,
        ISCO == 6153 ~ 11,
        ISCO == 6154 ~ 11,
        ISCO == 6210 ~ 11,
        ISCO == 8331 ~ 11,
        ISCO == 9211 ~ 11,
        ISCO == 9212 ~ 11,
        ISCO == 9213 ~ 11,
        ISCO == 6131 ~ 11,
        ISCO == 6132 ~ 11,
        ISCO == 6133 ~ 11,
        ISCO == 6200 ~ 11),
      EGP11 = case_when(
        PosicaoOcupacao == 2 & ISIC != 10 & ISIC != 100 ~ 5,
        PosicaoOcupacao == 2 & ISIC == 10 &
          EGP11 %in% c(1:4,8:11) ~ 6,
        EGP11 == 11 & PosicaoOcupacao %in% c(0,3) ~ 7,
        TRUE ~ EGP11)
    ) |>
    select(-c(var_trabalhando, var_afastado, var_aprendiz, var_trabalho_consumo,
              var_buscou_emprego, var_posicao_ocupacao,var_codigo_ocupacao,any_of(var_cnae_censo)))

  censo <- dados |>
    left_join(censo_processing,
              by = c("id_dom","id_pes"),
              keep = FALSE)

  # Lista que será retornada do processo
  results <- list(
    censo = censo,
    tabela = tabela
  )

  return(results)
}
